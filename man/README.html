<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>battery-alert</title>
  <style type="text/css">
    html {margin: 2em;} 
    h2 {margin-top: 2.5em; border-bottom:1px solid #D6D6D6;} 
    h3 {margin-top: 2em;} 
    dl {margin: 2em;} 
    dd {margin: 1em;} 
    dt {font-weight: bold;}
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
    html {margin: 2em;} 
    h2 {margin-top: 2.5em; border-bottom:1px solid #D6D6D6;} 
    h3 {margin-top: 2em;} 
    dl {margin: 2em;} 
    dd {margin: 1em;} 
    dt {font-weight: bold;}
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0;  background-color: #F6F6F6; margin: 1em; }
pre.sourceCode { margin: 2em; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
</header>
<h1 id="battery-alert">battery-alert</h1>
<p>Battery monitoring with visible and audible notification</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#description">Description</a>
<ul>
<li><a href="#notification-levels">Notification levels</a></li>
<li><a href="#alert-levels">Alert levels</a></li>
<li><a href="#halt-level">Halt level</a></li>
<li><a href="#audio-notification">Audio notification</a></li>
</ul></li>
<li><a href="#installation">Installation</a>
<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#procedure">Procedure</a>
<ul>
<li><a href="#using-git">Using git</a></li>
<li><a href="#zip-file">Zip file</a></li>
</ul></li>
<li><a href="#make-options">make options</a>
<ul>
<li><a href="#variables">Variables</a></li>
<li><a href="#command-line-parameters">Command line parameters</a></li>
</ul></li>
</ul></li>
<li><a href="#configuration">Configuration</a>
<ul>
<li><a href="#default-configuration">Default configuration</a></li>
</ul></li>
<li><a href="#execution">Execution</a>
<ul>
<li><a href="#systemd">systemd</a></li>
<li><a href="#openrc">openrc</a></li>
<li><a href="#runit">runit</a></li>
<li><a href="#manual-execution">Manual execution</a></li>
</ul></li>
<li><a href="#controlling-battery-alert">Controlling battery-alert</a></li>
<li><a href="#sources">Sources</a></li>
<li><a href="#changelog">Changelog</a></li>
</ol>
<h2 id="description">Description</h2>
<p><em>battery-alert</em> is yet another battery monitoring script, written in <strong>bash</strong> scripting language.</p>
<p>Its difference from other similar scripts is that it provides visible <strong>and audible</strong> notification depending on battery charging level.</p>
<p>The mentality behind this behavior is not to keep the system running as long as possible; it’s rather to keep the user notified about the situation and eventually halt the system before data loss occurs (due to an unexpected shutdown).</p>
<p>The need for this script emerged after having my laptop (running i3 window manager) powering off on me on various occasions, like while listening to music and dealing with other staff, etc.</p>
<p>In this respect, the script uses 5 levels (2 notification, 2 low level alert and a halt level).</p>
<p>All level data (messages, icons, sounds) are configurable (see <a href="#configuration">Configuration</a>).</p>
<h3 id="notification-levels">Notification levels</h3>
<p>The purpose of these notification levels is to try and keep the battery between 40%-80% of its maximum charging level at all times, in an attempt to extend its life.</p>
<ol type="1">
<li><p><strong>THRESHOLD_NOTIFY_HIGH</strong></p>
<p>High notification level. Default value: <strong>80%</strong>.</p></li>
<li><p><strong>THRESHOLD_NOTIFY_LOW</strong></p>
<p>Low notification level. Default value: <strong>40%</strong>.</p></li>
</ol>
<h3 id="alert-levels">Alert levels</h3>
<p>These levels will produce a visible warning and an “annoying” audible notification.</p>
<ol type="1">
<li><p><strong>THRESHOLD_HIGH</strong></p>
<p>High alert level. Notification will be active once every 60 seconds (default value). Default value: <strong>20%</strong>.</p></li>
<li><p><strong>THRESHOLD_LOW</strong></p>
<p>Low alert level. Notification will be displayed repeatedly. Default value: <strong>15%</strong>.</p></li>
</ol>
<h3 id="halt-level">Halt level</h3>
<ol type="1">
<li><p><strong>THRESHOLD_HALT</strong></p>
<p>System halt level. This is actually not a notification level, since when reached, the system will be halted. Default value: <strong>7%</strong>.</p>
<p>The command to halt the system is configurable (see <a href="#configuration">Configuration</a>).</p>
<p>Default command: <strong>systemctl poweroff</strong>.</p></li>
</ol>
<h3 id="audio-notification">Audio notification</h3>
<p>Audio playback will occur in the background (i.e. no program window of any kind will be visible). Playback volume will be the one set at the system mixer, so some precaution should take place on this respect. After all, what is the point in using audio notification if audio volume is low enough to make it inaudible?</p>
<p><em>battery-alert</em> by default uses <strong>mpg123</strong> as an audio player, because it is light-weight enough and gets installed by default on most systems, but any mp3 player can be used, provided that it is a terminal application (or it can hide its window) and will print no diagnostic or other messages in <em>stdout</em> (or it can suppress them).</p>
<p>If for any reason one prefers not to install it, or use a different player, or even not to use one at all, one should follow the <a href="#make-options">relevant installation instructions</a>.</p>
<h2 id="installation">Installation</h2>
<h3 id="requirements">Requirements</h3>
<p><em>battery-alert</em> depends on <strong>GNU make</strong> for its configuration.</p>
<p>The following programs are also used:</p>
<ol type="1">
<li><strong>coreutils</strong> - The basic file, shell and text manipulation</li>
<li><strong>ps</strong> - Report a snapshot of the current processes</li>
<li><strong>grep</strong> - A string search utility</li>
<li><strong>sed</strong> - GNU stream editor</li>
<li><strong>gzip</strong> - GNU compression utility</li>
</ol>
<p><em>battery-alert</em> depends on the follwoing programs for its execution:</p>
<ol type="1">
<li><strong>bash</strong> - Well, it is a <strong>bash</strong> script, after all</li>
<li><strong>bc</strong> - An arbitrary precision calculator language</li>
<li><strong>su</strong> - Run a command with substitute user and group ID (if run as a service; refer to: <a href="#execution">Execution</a>)</li>
<li><strong>libnotify</strong> - Library for sending desktop notifications (not required if <strong>console</strong> or <strong>console-no-mpg123</strong> make arguments are used; refer to <a href="#make-options">make options</a>)</li>
<li><strong>mpg123</strong> - A console based real time MPEG Audio Player for Layer 1, 2 and 3 (optional)</li>
</ol>
<h3 id="procedure">Procedure</h3>
<p>Download <em>battery-alert</em> either using <strong>git</strong> or by a <strong>zip file</strong>.</p>
<h4 id="using-git">Using git</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb1-1" data-line-number="1">git clone https:<span class="ot">//</span>github.com/s-n-g/battery-alert.git</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">cd battery-alert</a></code></pre></div>
<h4 id="zip-file">Zip file</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" data-line-number="1">wget https:<span class="ot">//</span>github.com/s-n-g/battery-alert/archive/master.zip</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">unzip master.zip</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">cd battery-alert-master</a></code></pre></div>
<p>Run make (refer to <a href="#make-options">make options</a> for installation customization)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb3-1" data-line-number="1">make</a></code></pre></div>
<p>Finally, go on and install it</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb4-1" data-line-number="1">sudo make install</a></code></pre></div>
<h3 id="make-options">make options</h3>
<h4 id="variables">Variables</h4>
<p>The <strong>Makefile</strong> that comes with the package provides a couple of variables which control the installation process:</p>
<dl>
<dt>
SHELL
</dt>
<dd>
The shell to be used by <b>make</b> for its execution.
</dd>
<dd>
Default value: <b>/bin/bash</b>
</dd>
<dt>
PREFIX
</dt>
<dd>
Script installation prefix. The script will actually be installed in <strong>$PREFIX/bin</strong>.
</dd>
<dd>
Default value: <b>/usr/local</b>
</dd>
<dt>
SYSTEMD_SERVICES_DIRECTORY
</dt>
<dd>
Systemd installation directory. This is where the service file will be copied.
</dd>
<dd>
Default value: <b>/lib/systemd/system</b>
</dd>
</dl>
<p>If necessary, the <strong>Makefile</strong> should be edited so that these two variables match the system at hand.</p>
<dl>
<dt>
Note
</dt>
<dd>
If the system is a <b>non-systemd</b> one, no file editing is needed; <b>make</b> will detect the situation and will not install a systemd service.
</dd>
</dl>
<h4 id="command-line-parameters">Command line parameters</h4>
<p>In addition to those, the following targets (command line augments to <strong>make</strong>):</p>
<dl>
<dt>
default
</dt>
<dd>
Contains the default options for <i>battery-alert</i>.
</dd>
<dd>
These are the options used when <b>make</b> is executed without any arguments.
</dd>
<dd>
Options description:
<dd>
<ol>
<li>
make sure essential packages are already installed
</li>
<li>
make sure <i>notify-send</i> executable is already installed
</li>
<li>
make sure <i>mpg123</i> executable is already installed
</li>
<li>
make sure <i>systemd service</i> is up to date
</li>
</ol>
</dl>
<dl>
<dt>
no-mpg123
</dt>
<dd>
Do not require <b>mpg123</b> to be installed.
</dd>
<dt>
console
</dt>
<dd>
This option will disable visual notification. In other words, one would use this option to have <i>battery-alert</i> running on a non-graphical environment.
</dd>
<dt>
console-no-mpg123
</dt>
<dd>
Same as above, but <b>mpg123</b> would not be required.
</dd>
<dt>
help
</dt>
<dd>
print help screen and exit
</dd>
</dl>
<p>Example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb5-1" data-line-number="1">$ make</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">** <span class="dt">Checking</span> <span class="kw">for</span> essential packages ... done </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">** <span class="dt">Checking</span> <span class="kw">for</span> notify-send ... found</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">** <span class="dt">Checking</span> <span class="kw">for</span> mpg123 ... <span class="kw">not</span> found</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  *** <span class="dt">You</span> must install mpg123 (package mpg123)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">make: </span>*** [<span class="dt">Makefile</span>:<span class="dv">42</span>: with_mpg123] <span class="dt">Error</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">$</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">$ make no-mpg123</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">** <span class="dt">Checking</span> <span class="kw">for</span> essential packages ... done </a>
<a class="sourceLine" id="cb5-10" data-line-number="10">** <span class="dt">Checking</span> <span class="kw">for</span> notify-send ... found</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="dt">Creating</span> systemd service ... done</a></code></pre></div>
<dl>
<dt>
Note
</dt>
<dd>
In this case, a valid <b>PLAYER_COMMAND</b> has to be provided for audio notification to work (see <a href="#configuration">Configuration</a>).
<dd>
If <b>PLAYER_COMMAND</b> is empty or invalid, audio notification will be inhibited.
</dd>
</dl>
<h2 id="configuration">Configuration</h2>
<p>The package’s system wide configuration is located in <strong>/etc/battery-alert.conf</strong>.</p>
<p>To customize it, one has to create a user writable configuration file and edit it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb6-1" data-line-number="1">mkdir ~<span class="ot">/.config/</span>battery-alert</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">cp <span class="ot">/etc/</span>battery-alert.conf ~<span class="ot">/.config/</span>battery-alert/config</a></code></pre></div>
<p>Before editing the file, one should suspend <em>battery-alert</em>, if it is running.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb7-1" data-line-number="1">battery-alert suspend</a></code></pre></div>
<p>After editing this file, one should source it in order to check its validity.</p>
<p>On a <strong>bash</strong> terminal:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb8-1" data-line-number="1">. ~<span class="ot">/.config/</span>battery-alert/config</a></code></pre></div>
<p>If no error occurs, you are good to go.</p>
<p>If <em>battery-alert</em> has been suspended, resume its execution.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb9-1" data-line-number="1">battery-alert resume</a></code></pre></div>
<dl>
<dt>
Note
</dt>
<dd>
If an error occurs, <i>battery-alert</i> will terminate, so be aware.
</dd>
</dl>
<h3 id="default-configuration">Default configuration</h3>
<p>The default configuration is the following:</p>
<ul>
<li>if battery goes over 80%, issue notification “<strong>Disconnect power supply</strong>”</li>
<li>if battery drops below 40%, issue notification “<strong>Connect power supply</strong>”</li>
<li>if battery drops below 20%, issue notification “<strong>Low battery</strong>” every 30 seconds</li>
<li>if battery drops below 15%, issue notification “<strong>Low battery</strong>” repeatedly</li>
<li>if battery drops below 7%, <strong>halt</strong> the system</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># USER</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co"># This will be the user that visual notification will</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co"># be executed for. Default value is the user name of</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"># whoever executes make</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="dt">USER</span>=spiros</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co"># THRESHOLDS DEFINITION</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co"># Thresholds are defined in arrays</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co"># Items are:</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#  0  battery limit</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#  1  message title to display</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#  2  message to display</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#  3  icon to display</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#     either absolute or relative path to file</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#     if relative, it should be in /usr/share/battery-alert</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#  4  sound to play</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#     path works the same as with icon</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#  5  time to display notification (in milliseconds)</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#     it should be the same as the duration</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#     of the sound file</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#  6  check interval (in seconds)</span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"><span class="co">#     time to wait between battery status check</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="co">#     if it is 0, do not wait</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="co">#     effectively displaying notification repeatedly</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co">#  7  Enable / Disable</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="co">#     Applies on notification alerts only</span></a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="co">#     Value: [yes] / no</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="co">#  - THRESHOLD_HIGH</span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="co">#    If battery percentage is lower than this, a notification</span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"><span class="co">#    will be displayed and a sound will be played once</span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="dt">THRESHOLD_HIGH</span>[<span class="dv">0</span>]=<span class="dv">20</span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="dt">THRESHOLD_HIGH</span>[<span class="dv">1</span>]=<span class="st">&quot;Low battery&quot;</span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34"><span class="dt">THRESHOLD_HIGH</span>[<span class="dv">2</span>]=<span class="st">&quot;Battery running critically low at $charge_percent%!&quot;</span></a>
<a class="sourceLine" id="cb10-35" data-line-number="35"><span class="dt">THRESHOLD_HIGH</span>[<span class="dv">3</span>]=warning-high.png</a>
<a class="sourceLine" id="cb10-36" data-line-number="36"><span class="dt">THRESHOLD_HIGH</span>[<span class="dv">4</span>]=warning-low.mp3</a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="dt">THRESHOLD_HIGH</span>[<span class="dv">5</span>]=<span class="dv">7000</span></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="dt">THRESHOLD_HIGH</span>[<span class="dv">6</span>]=<span class="dv">30</span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"></a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="co">#  - THRESHOLD_LOW</span></a>
<a class="sourceLine" id="cb10-41" data-line-number="41"><span class="co">#    If battery percentage is lower than this, both the</span></a>
<a class="sourceLine" id="cb10-42" data-line-number="42"><span class="co">#    notification and the sund will be on indefinatelly</span></a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="dt">THRESHOLD_LOW</span>[<span class="dv">0</span>]=<span class="dv">15</span></a>
<a class="sourceLine" id="cb10-44" data-line-number="44"><span class="dt">THRESHOLD_LOW</span>[<span class="dv">1</span>]=<span class="st">&quot;Low battery&quot;</span></a>
<a class="sourceLine" id="cb10-45" data-line-number="45"><span class="dt">THRESHOLD_LOW</span>[<span class="dv">2</span>]=<span class="st">&quot;Battery running critically low at $charge_percent%!&quot;</span></a>
<a class="sourceLine" id="cb10-46" data-line-number="46"><span class="dt">THRESHOLD_LOW</span>[<span class="dv">3</span>]=warning-low.png</a>
<a class="sourceLine" id="cb10-47" data-line-number="47"><span class="dt">THRESHOLD_LOW</span>[<span class="dv">4</span>]=warning-low.mp3</a>
<a class="sourceLine" id="cb10-48" data-line-number="48"><span class="dt">THRESHOLD_LOW</span>[<span class="dv">5</span>]=<span class="dv">7000</span></a>
<a class="sourceLine" id="cb10-49" data-line-number="49"><span class="dt">THRESHOLD_LOW</span>[<span class="dv">6</span>]=<span class="dv">0</span></a>
<a class="sourceLine" id="cb10-50" data-line-number="50"></a>
<a class="sourceLine" id="cb10-51" data-line-number="51"><span class="co">#  - THRESHOLD_HALT</span></a>
<a class="sourceLine" id="cb10-52" data-line-number="52"><span class="co">#    If a HALT_COMMAND is defined, the PC will be halted /</span></a>
<a class="sourceLine" id="cb10-53" data-line-number="53"><span class="co">#    powered off, when battery status is bellow this</span></a>
<a class="sourceLine" id="cb10-54" data-line-number="54"><span class="co">#    threshold</span></a>
<a class="sourceLine" id="cb10-55" data-line-number="55"><span class="co">#</span></a>
<a class="sourceLine" id="cb10-56" data-line-number="56"><span class="co">#    only item 0 has any meaning here</span></a>
<a class="sourceLine" id="cb10-57" data-line-number="57"><span class="dt">THRESHOLD_HALT</span>[<span class="dv">0</span>]=<span class="dv">7</span></a>
<a class="sourceLine" id="cb10-58" data-line-number="58"></a>
<a class="sourceLine" id="cb10-59" data-line-number="59"><span class="co">#  - THRESHOLD_NOTIFY_HIGH</span></a>
<a class="sourceLine" id="cb10-60" data-line-number="60"><span class="co">#    Notify that user can now disconnect the power supply</span></a>
<a class="sourceLine" id="cb10-61" data-line-number="61"><span class="dt">THRESHOLD_NOTIFY_HIGH</span>[<span class="dv">0</span>]=<span class="dv">80</span></a>
<a class="sourceLine" id="cb10-62" data-line-number="62"><span class="dt">THRESHOLD_NOTIFY_HIGH</span>[<span class="dv">1</span>]=<span class="st">&quot;Battery notification&quot;</span></a>
<a class="sourceLine" id="cb10-63" data-line-number="63"><span class="dt">THRESHOLD_NOTIFY_HIGH</span>[<span class="dv">2</span>]=<span class="st">&quot;You can now disconnect the power supply&quot;</span></a>
<a class="sourceLine" id="cb10-64" data-line-number="64"><span class="dt">THRESHOLD_NOTIFY_HIGH</span>[<span class="dv">3</span>]=notify-high.png</a>
<a class="sourceLine" id="cb10-65" data-line-number="65"><span class="dt">THRESHOLD_NOTIFY_HIGH</span>[<span class="dv">4</span>]=notify-high.mp3</a>
<a class="sourceLine" id="cb10-66" data-line-number="66"><span class="dt">THRESHOLD_NOTIFY_HIGH</span>[<span class="dv">5</span>]=<span class="dv">5300</span></a>
<a class="sourceLine" id="cb10-67" data-line-number="67"><span class="dt">THRESHOLD_NOTIFY_HIGH</span>[<span class="dv">6</span>]=<span class="dv">60</span></a>
<a class="sourceLine" id="cb10-68" data-line-number="68"><span class="dt">THRESHOLD_NOTIFY_HIGH</span>[<span class="dv">7</span>]=yes</a>
<a class="sourceLine" id="cb10-69" data-line-number="69"></a>
<a class="sourceLine" id="cb10-70" data-line-number="70"><span class="co">#  - THRESHOLD_NOTIFY_LOW</span></a>
<a class="sourceLine" id="cb10-71" data-line-number="71"><span class="co">#    Notify that user should now connect the power supply</span></a>
<a class="sourceLine" id="cb10-72" data-line-number="72"><span class="dt">THRESHOLD_NOTIFY_LOW</span>[<span class="dv">0</span>]=<span class="dv">40</span></a>
<a class="sourceLine" id="cb10-73" data-line-number="73"><span class="dt">THRESHOLD_NOTIFY_LOW</span>[<span class="dv">1</span>]=<span class="st">&quot;Battery notification&quot;</span></a>
<a class="sourceLine" id="cb10-74" data-line-number="74"><span class="dt">THRESHOLD_NOTIFY_LOW</span>[<span class="dv">2</span>]=<span class="st">&quot;You should now connect the power supply&quot;</span></a>
<a class="sourceLine" id="cb10-75" data-line-number="75"><span class="dt">THRESHOLD_NOTIFY_LOW</span>[<span class="dv">3</span>]=notify-low.png</a>
<a class="sourceLine" id="cb10-76" data-line-number="76"><span class="dt">THRESHOLD_NOTIFY_LOW</span>[<span class="dv">4</span>]=notify-low.mp3</a>
<a class="sourceLine" id="cb10-77" data-line-number="77"><span class="dt">THRESHOLD_NOTIFY_LOW</span>[<span class="dv">5</span>]=<span class="dv">5300</span></a>
<a class="sourceLine" id="cb10-78" data-line-number="78"><span class="dt">THRESHOLD_NOTIFY_LOW</span>[<span class="dv">6</span>]=<span class="dv">60</span></a>
<a class="sourceLine" id="cb10-79" data-line-number="79"><span class="dt">THRESHOLD_NOTIFY_LOW</span>[<span class="dv">7</span>]=yes</a>
<a class="sourceLine" id="cb10-80" data-line-number="80"></a>
<a class="sourceLine" id="cb10-81" data-line-number="81"><span class="co"># END OF THRESHOLDS DEFINITION</span></a>
<a class="sourceLine" id="cb10-82" data-line-number="82"></a>
<a class="sourceLine" id="cb10-83" data-line-number="83"><span class="co"># This is the command what will play the warning message.</span></a>
<a class="sourceLine" id="cb10-84" data-line-number="84"><span class="co"># Default is mpg123, since it&#39;s very light on resources.</span></a>
<a class="sourceLine" id="cb10-85" data-line-number="85"><span class="co"># If empty, no sound will be played</span></a>
<a class="sourceLine" id="cb10-86" data-line-number="86"><span class="co">#</span></a>
<a class="sourceLine" id="cb10-87" data-line-number="87"><span class="co"># Examples:</span></a>
<a class="sourceLine" id="cb10-88" data-line-number="88"><span class="co">#PLAYER_COMMAND=&quot;cvlc -q&quot;</span></a>
<a class="sourceLine" id="cb10-89" data-line-number="89"><span class="co">#PLAYER_COMMAND=&quot;ffplay -volume 100 --autoexit -nodisp -v 0 -i&quot;</span></a>
<a class="sourceLine" id="cb10-90" data-line-number="90"><span class="co">#PLAYER_COMMAND=&quot;mplayer -msglevel all=-1&quot;</span></a>
<a class="sourceLine" id="cb10-91" data-line-number="91"><span class="co">#PLAYER_COMMAND=&quot;play -q&quot;</span></a>
<a class="sourceLine" id="cb10-92" data-line-number="92"><span class="dt">PLAYER_COMMAND</span>=<span class="st">&quot;mpg123 -q&quot;</span></a>
<a class="sourceLine" id="cb10-93" data-line-number="93"></a>
<a class="sourceLine" id="cb10-94" data-line-number="94"><span class="co"># HALT COMMAND DEFINITION</span></a>
<a class="sourceLine" id="cb10-95" data-line-number="95"><span class="co"># Define here the command to be used to power off your PC</span></a>
<a class="sourceLine" id="cb10-96" data-line-number="96"><span class="co"># It&#39;s up to you to make sure the command can be executed</span></a>
<a class="sourceLine" id="cb10-97" data-line-number="97"><span class="co"># (has the right permission etc.)</span></a>
<a class="sourceLine" id="cb10-98" data-line-number="98"><span class="co">#</span></a>
<a class="sourceLine" id="cb10-99" data-line-number="99"><span class="co"># Examples:</span></a>
<a class="sourceLine" id="cb10-100" data-line-number="100"><span class="co">#HALT_COMMAND=&quot;xfce4-session-logout -h&quot;</span></a>
<a class="sourceLine" id="cb10-101" data-line-number="101"><span class="co">#HALT_COMMAND=&quot;xfce4-session-logout -s&quot;</span></a>
<a class="sourceLine" id="cb10-102" data-line-number="102"><span class="co">#HALT_COMMAND=&quot;xfce4-session-logout --hibernate&quot;</span></a>
<a class="sourceLine" id="cb10-103" data-line-number="103"><span class="co">#HALT_COMMAND=&quot;systemctl suspend&quot;</span></a>
<a class="sourceLine" id="cb10-104" data-line-number="104"><span class="co">#HALT_COMMAND=&quot;systemctl hibernate&quot;</span></a>
<a class="sourceLine" id="cb10-105" data-line-number="105"><span class="co">#HALT_COMMAND=&quot;systemctl hybrid-sleep&quot;</span></a>
<a class="sourceLine" id="cb10-106" data-line-number="106"><span class="dt">HALT_COMMAND</span>=<span class="st">&quot;systemctl poweroff&quot;</span></a></code></pre></div>
<h2 id="execution">Execution</h2>
<p>Once <em>battery-alert</em> is installed, one can test it using the following command:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb11-1" data-line-number="1">battery-alert test</a></code></pre></div>
<p>This will display (and play) all available alerts and notifications that will be used in normal operation.</p>
<h3 id="systemd">systemd</h3>
<p>To execute <em>battery-alert</em>, run the command:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb12-1" data-line-number="1">sudo systemctl start battery-alert</a></code></pre></div>
<p>To have <em>battery-alert</em> run on system start up, run the command:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb13-1" data-line-number="1">sudo systemctl enable battery-alert</a></code></pre></div>
<h3 id="openrc">openrc</h3>
<p>To execute <em>battery-alert</em>, run the command:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb14-1" data-line-number="1">sudo <span class="ot">/etc/ini</span>t.d/battery-alert start</a></code></pre></div>
<p>To have <em>battery-alert</em> run on system start up, run the command:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb15-1" data-line-number="1">sudo rc-update add battery-alert</a></code></pre></div>
<h3 id="runit">runit</h3>
<p>To have <em>battery-alert</em> run on system start up and execute it, run the command:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb16-1" data-line-number="1">sudo ln -s <span class="ot">/etc/</span>sv/battery-alert <span class="ot">/var/</span>service</a></code></pre></div>
<h3 id="manual-execution">Manual execution</h3>
<p>If one prefers to manually execute <em>battery-alert</em>, he has to do that through the auto start feature provided by the DE or WM.</p>
<p>For example, if using i3, one would add the following line to <strong>~/.config/i3/config</strong>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb17-1" data-line-number="1">exec --no-startup-id <span class="ot">/usr/</span>loca/bin/battery-alert</a></code></pre></div>
<h2 id="controlling-battery-alert">Controlling battery-alert</h2>
<p>Communication with <em>battery-alert</em> is done from command line.</p>
<p><em>battery-alert</em> listens for input on a named pipe (FIFO), <strong>/tmp/battery-alert</strong>.</p>
<p>Available commands:</p>
<dl>
<dt>
suspend
</dt>
<dd>
suspend execution - the script stops checking and reporting battery status
</dd>
<dt>
resume
</dt>
<dd>
resume execution - the script resumes checking and reporting battery status
</dd>
<dt>
status
</dt>
<dd>
report status - returns a string, either “<b>running</b>”, “<b>suspended</b>” or “<b>not running</b>”
</dd>
<dt>
vstatus
</dt>
<dd>
report status visually - displays a notification reporting its current status
</dd>
<dt>
test
</dt>
<dd>
display (and play) all notification that would occur under normal operation
</dd>
<dt>
exit | quit
</dt>
<dd>
terminate execution
</dd>
</dl>
<p>Example:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb18-1" data-line-number="1">battery-alert status</a></code></pre></div>
<h2 id="sources">Sources</h2>
<h3 id="and-resources">(and resources)</h3>
<ul>
<li><p>The script is based on the <a href="https://agorf.gr/2016/06/29/low-battery-notification-in-i3wm/">batmon</a> script by <strong>Angelos Orfanakos</strong>, published under the <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p></li>
<li><p>The icons are derived from <a href="https://github.com/maateen/battery-monitor">maateen/battery-monitor</a>.</p></li>
<li><p>The sounds come from the Public Domain and <a href="http://www.fromtexttospeech.com">www.fromtexttospeech.com</a>.</p></li>
<li><p>Numerous web pages on <strong>bash</strong> scripting, <strong>make</strong> and <strong>github markup</strong>.</p></li>
</ul>
<h2 id="changelog">Changelog</h2>
<ul>
<li><p>4/6/18</p>
<p>First public release</p></li>
</ul>
</body>
</html>
